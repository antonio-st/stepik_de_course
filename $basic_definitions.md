 # Виды БД


1. Иерархические
2. Объектно-ориентированные
3. Реляционные 
4. Сетевые
5. Графовые

# Свойства ACID и транзакции

## Транзакция

**Транзакция** – это команда или блок команд (инструкций), которые успешно завершаются как единое целое, при этом в базе данных все внесенные изменения фиксируются на постоянной основе, или отменяются, т.е. все изменения, внесенные любой командой, входящей в транзакцию, будут отменены.

Другими словами, если одна команда или инструкция внутри транзакции завершилась с ошибкой, то все, что было отработано перед ней, также отменяется, даже если предыдущие команды завершились успешно.

## Свойства ACID

Atomicity - атомарность.\
Consistency - согласованность.\
Isolation - изоляция.\
Durability - устойчивость.


**Atomicity - атомарность.**

Атомарность гарантирует, что никакая транзакция не будет зафиксирована в системе частично. Будут либо выполнены все её подоперации, либо не выполнено ни одной. \
Поскольку на практике невозможно одновременно и атомарно выполнить всю последовательность операций внутри транзакции, вводится понятие «отката» (rollback): если транзакцию не удаётся полностью завершить, результаты всех её до сих пор произведённых действий будут отменены и система вернётся во «внешне исходное» состояние — со стороны будет казаться, что транзакции и не было (естественно, счётчики, индексы и другие внутренние структуры могут измениться, но, если СУБД запрограммирована без ошибок, это не повлияет на внешнее её поведение).

**Consistency - согласованность.**

Согласованность является более широким понятием. Например, в банковской системе может существовать требование равенства суммы, списываемой с одного счёта, сумме, зачисляемой на другой.\
Это — бизнес-правило, и оно не может быть гарантировано только проверками целостности, его должны соблюсти программисты при написании кода транзакций. Если какая-либо транзакция произведёт списание, но не произведёт зачисления, то система останется в некорректном состоянии и свойство согласованности будет нарушено.

**Isolation - изоляция.**

Во время выполнения транзакции параллельные транзакции не должны оказывать влияния на её результат. 

**Durability - устойчивость.**

Независимо от проблем на нижних уровнях (к примеру, обесточивание системы или сбои в оборудовании) изменения, сделанные успешно завершённой транзакцией, должны остаться сохранёнными после возвращения системы в работу. \
Другими словами, если пользователь получил подтверждение от системы, что транзакция выполнена, он может быть уверен, что сделанные им изменения не будут отменены из-за какого-либо сбоя.


 # Нормальные формы

`Первая нормальная форма (1НФ)`: Все значения в таблице должны быть атомарными, то есть не разбиваться на более мелкие части.

`Вторая нормальная форма (2НФ):` Каждый столбец, не являющийся ключом, должен полностью зависеть от первичного ключа.

`Третья нормальная форма (3НФ):` Каждый столбец, не являющийся ключом, должен зависеть только от первичного ключа, а не от других столбцов.

`Нормальная форма Бойса-Кодда (BCNF):` Она является более строгим вариантом третьей нормальной формы и устраняет некоторые виды избыточности данных.

`Четвертая, пятая и шестая нормальные формы:` Эти нормальные формы редко используются в практике и предназначены для более тщательной нормализации данных.


# Виды СУБД. OLAP - OLTP

`OLTP` (англ. Online Transaction Processing) или реляционные БД- это базы данных, которые используются везде и повсеместно. Их основная цель - ввод/редактирование/удаление данных в режиме онлайн. Примеры использования: мессенджеры, социальные сети, 1С: Бухгалтерия и т.д.

`OLAP` (англ. Online Analytical Processing) или многомерные БД - это базы данных, которые служат непосредственно для проведения быстрого анализа больших объемов данных. \
Обычно такие БД используются на больших предприятиях для построения аналитической отчетности за большой промежуток времени (месяц, квартал, год). Такая информация в основном используется для анализа прошедшего периода и планирования будущего. Основные пользователи аналитических данных - руководители.

### ClickHouse

`ClickHouse` – система управления базами данных, которую разработали в Яндекс. Изначально СУБД разработали специально для работы с огромными массивами данных Яндекс.Метрики. 

В ClickHouse организована архитектура столбцового хранения данных,  и по этой же причине  большинство OLAP СУБД — столбцовые.


# DWH

`DWH (Data Warehouse)` - это централизованное хранилище данных, предназначенное для хранения и анализа больших объемов данных из различных источников. DWH служит основой для аналитического процесса и принятия решений в организации.

**Основные характеристики DWH:**

1. Централизованное хранилище данных: DWH объединяет данные из различных операционных источников данных в одно централизованное хранилище. Это позволяет упростить доступ и анализ данных, а также обеспечить единообразие и согласованность данных.

2. Оптимизированная схема данных: Данные в DWH организованы в оптимизированной структуре, обеспечивающей быстрый доступ к данным для аналитических целей. Обычно используются схемы звезды или снежинки, которые оптимизированы для выполнения агрегированных запросов и аналитических операций.

3. Исторические данные: DWH хранит исторические данные, которые могут быть использованы для анализа трендов, прошлых результатов и прогнозирования будущих событий. Благодаря хранению исторических данных, DWH позволяет анализировать долгосрочные паттерны и проводить корреляционный анализ между различными временными периодами.

4. Интеграция данных: DWH интегрирует данные из различных источников, таких как транзакционные базы данных, внешние системы, веб-сервисы, ERP и другие источники данных. Это позволяет анализировать данные из разных источников и создавать комплексные отчеты и аналитические модели.

5. Аналитический инструментарий: DWH предоставляет набор инструментов и возможностей для анализа данных, включая OLAP (Online Analytical Processing), инструменты визуализации данных, аналитические отчеты, машинное обучение и другие методы анализа данных. Это позволяет пользователям проводить сложный анализ данных и получать ценную информацию для принятия решений.
DWH (Data Warehouse) обычно включают в себя следующие основные компоненты:

### Основные компоненты DWH

1. ETL (Extract, Transform, Load): ETL является ключевым компонентом DWH и отвечает за извлечение данных из различных источников, их трансформацию и загрузку в хранилище данных. ETL процесс обеспечивает очистку, преобразование и интеграцию данных, чтобы они соответствовали требованиям DWH.

2. Хранилище данных: Хранилище данных представляет собой централизованное место для хранения и управления данными в DWH. Обычно используется реляционная база данных, специально оптимизированная для аналитических операций и запросов.

3. Моделирование данных: Моделирование данных включает определение структуры данных в DWH, таких как схемы звезды или снежинки (об этом далее). Моделирование данных облегчает аналитический процесс и обеспечивает эффективность выполнения запросов.

4. Аналитический инструментарий: Аналитический инструментарий включает набор инструментов и технологий для анализа данных в DWH. Это может включать OLAP (Online Analytical Processing) инструменты, инструменты визуализации данных, инструменты машинного обучения и другие.

5. Метаданные: Метаданные представляют собой описание и характеристики данных в DWH. Они содержат информацию о структуре данных, источниках, связях между таблицами и другие метаданные, необходимые для понимания и использования данных в DWH.

6. Инструменты администрирования: Инструменты администрирования обеспечивают управление и мониторинг DWH, включая задачи управления пользователями, безопасностью, мониторинг производительности, резервное копирование и восстановление данных и другие административные функции.

## Известные модели данных: звезда и снежинка


`Схема типа «звезда»` имеет централизованное хранилище данных, которое хранится в таблице фактов. Схема разбивает таблицу фактов на ряд денормализованных таблиц измерений. Таблица фактов FACT содержит данные, которые будут использоваться для составления отчетов, а таблица измерений DIM (от англ. Dimension - измерение) описывает хранимые данные.

`Схема типа «снежинка»` отличается тем, что использует нормализованные данные. Нормализация означает эффективную организацию данных так, чтобы все зависимости данных были определены, и каждая таблица содержала минимум избыточности. Таким образом, отдельные таблицы измерений разветвляются на отдельные дополнительные таблицы измерений.


## DataVault

`Data Vault` - это методология проектирования хранилищ данных, которая обеспечивает гибкость, масштабируемость и отслеживаемость изменений в данных. Она была разработана Дэном Линстедом (Dan Linstedt) и ориентирована на создание гибких и устойчивых хранилищ данных для аналитических целей. Основные принципы Data Vault включают:

1. Модульность: Хранилище данных строится из набора модулей (hubs, links, satellites), каждый из которых отвечает за определенный аспект данных и может быть легко модифицирован или расширен без влияния на другие части хранилища.

2. Историчность: Data Vault сохраняет всю историю изменений данных, что позволяет аналитикам проводить анализ изменений во времени и понимать эволюцию данных.

3. Гибкость: Модель Data Vault легко адаптируется к изменениям в структуре и источниках данных, что делает ее более гибкой и устойчивой к изменениям в бизнес-требованиях.

4. Отслеживаемость: Data Vault обеспечивает четкое отслеживание источников данных и связей между ними, что облегчает понимание происхождения и структуры данных.


`Data Vault` состоит из трех основных элементов: `хабов (hubs)`, `связей (links)` и `спутников (satellites)`.


1. Хабы (Hubs): Хабы представляют собой уникальные списки ключей для каждой сущности данных. Они являются центральными элементами модели и служат для централизованного хранения ключевых атрибутов сущности.

2. Связи (Links): Связи представляют собой ассоциативные таблицы, которые устанавливают связь между хабами. Они позволяют моделировать связи между различными сущностями данных.

3. Спутники (Satellites): Спутники содержат атрибуты, которые описывают контекст или детали данных из хабов или связей. Они могут содержать дополнительные атрибуты сущности, исторические данные или метаданные.


# NoSQL хранилища данных

> NoSQL (от англ. not only SQL — «не только SQL») — обозначение широкого класса разнородных систем управления базами данных, появившихся в конце 2000-х — начале 2010-х годов и существенно отличающихся от традиционных реляционных СУБД. Уже само название заявляет, что управлять данными можно не только с помощью Structured Query Language (SQL), т. е. языка структурированных запросов.

### Огранияения реляционных баз данных

+ Масштабируемость: Традиционные SQL базы данных не всегда хорошо справляются с горизонтальным масштабированием (увеличением числа серверов).
+ Гибкость схемы: В реляционных базах данных структура таблиц жестко определена, что усложняет работу с данными, структура которых часто меняется.
+ Производительность: При работе с очень большими объемами данных, запросы могут становиться медленными.


### Новые требования к базам данных

+ Большие данные: Необходимость обрабатывать и хранить огромные объемы данных.
+ Разнообразие данных: Различные типы данных (тексты, изображения, видео, JSON документы и т.д.).
+ Гибкость: Быстрая адаптация под изменяющиеся потребности бизнеса.


NoSQL предлагает несколько `важных преимуществ` - в противовес недостаткам реляционных баз данных:

+ Масштабируемость: Легко масштабируются горизонтально, распределяя данные по множеству серверов.
+ Гибкость схемы: Нет жесткой структуры, что позволяет хранить разнородные данные и изменять структуру данных на лету.
+ Высокая производительность: Оптимизированы для обработки больших объемов данных и высоких нагрузок.

> NoSQL : базы данных, которые жертвуют атомарностью и согласованностью ради масштабируемости и доступности


## Теоремы CAP

> В 2000 году Эрик Брюер (Eric Brewer), профессор компьютерных наук в Калифорнийском университете в Беркли, на конференции PODC (Principles of Distributed Computing) представил свои идеи о том, что распределенная система не может одновременно обеспечивать все три свойства — согласованность, доступность и устойчивость к разделению. Позднее эти идеи были формализованы как теорема CAP.

Теорема CAP утверждает, что в любой распределенной системе возможно обеспечить только два из трех свойств одновременно:

1. Согласованность (Consistency): Все узлы в системе имеют одинаковые данные в любой момент времени.
2. Доступность (Availability): Каждый запрос к системе получает ответ (не обязательно успешный) в течение разумного времени.
3. Устойчивость к разделению (Partition Tolerance): Система продолжает функционировать, несмотря на разделение сети, которое может приводить к тому, что сообщения между узлами теряются или задерживаются.


## Архитектура BASE

> BASE — это акроним, обозначающий принципы, используемые для проектирования распределенных систем и баз данных, которые делают упор на доступность и устойчивость к отказам, жертвуя строгой согласованностью. Концепция BASE (Basically Available, Soft state, Eventual consistency) возникла как альтернатива модели ACID, применяемой в традиционных реляционных базах данных.


**Компоненты BASE**

1. `Basically Available` (В основном доступная)
    Описание: Система гарантирует доступность, то есть всегда отвечает на запросы, хотя ответ может быть не мгновенным или не всегда успешным.
    Пример: В случае перегрузки система может вернуть менее точные данные или частичные результаты, но не "упадет".

2. `Soft state` (Мягкое состояние)
    Описание: Состояние системы может изменяться со временем, даже без получения входных данных. Это связано с тем, что система не обязана немедленно поддерживать согласованное состояние во всех узлах.
    Пример: Кэшированные данные могут постепенно обновляться или устаревать, и это не вызывает немедленного отказа системы.

3. `Eventual consistency` (Согласованность в конечном итоге)
    Описание: Система гарантирует, что в конечном счете все узлы придут к согласованному состоянию, но не обязательно мгновенно. С течением времени и при отсутствии новых изменений данные будут согласованы.
    Пример: В системе может быть момент, когда разные узлы имеют разные версии данных, но со временем эти версии синхронизируются.


**Сравнение BASE и ACID**

> ACID (Atomicity, Consistency, Isolation, Durability) модель, используемая в реляционных базах данных, ориентирована на строгое соблюдение согласованности и надежности транзакций:

+ Atomicity (Атомарность): Транзакция выполняется полностью или не выполняется вовсе.
+ Consistency (Согласованность): Транзакция переводит базу данных из одного согласованного состояния в другое.
+ Isolation (Изоляция): Одновременные транзакции не влияют друг на друга.
+ Durability (Долговечность): После завершения транзакции ее результаты сохраняются даже при сбоях системы.

> BASE модель, напротив, делает упор на доступность и масштабируемость, жертвуя строгой согласованностью:

+ Basically Available (В основном доступная): Система всегда доступна для обработки запросов.
+ Soft state (Мягкое состояние): Состояние системы может изменяться со временем.
+ Eventual consistency (Согласованность в конечном итоге): В конечном итоге все узлы придут к согласованному состоянию.


# Озеро данных (Data Lake)

Озеро данных (Data Lake) - это архитектурный подход к хранению и обработке больших объемов разнообразных данных в исходном формате, без предварительной обработки или структурирования.\
 Оно представляет собой централизованное хранилище данных, в которое собираются данные из различных источников, таких как транзакционные системы, социальные сети, датчики IoT, логи приложений и другие.

То есть не существует каких-либо готовых образов озер данных. Они всегда создаются с нуля и наполняются разнородными данными.

Основные характеристики озера данных:

1. Хранение в исходном формате: Данные в озере хранятся в исходном, непреобразованном виде, что позволяет сохранить их интегритет и предоставляет гибкость для последующей обработки и анализа.

2. Масштабируемость: Озеро данных способно хранить и обрабатывать огромные объемы данных, включая структурированные, неструктурированные и полуструктурированные данные.

3. Разнообразие данных: В озере данных могут храниться данные различных типов и форматов, такие как текстовые документы, изображения, аудио- и видеофайлы, JSON, XML, CSV, Parquet, Avro и многие другие.

4. Гибкий доступ и анализ: Озеро данных предоставляет гибкий доступ к данным и позволяет проводить анализ, исследования и выявление инсайтов с использованием различных инструментов и технологий.

5. Обработка в разном масштабе: Данные в озере могут быть обработаны как в реальном времени, так и в пакетном режиме, в зависимости от требований к конкретным задачам и приложениям.

6. Безопасность и управление данными: Важным аспектом озера данных является обеспечение безопасности данных и управление доступом к ним, включая контроль доступа, аудит, шифрование и управление версиями.


`Архитектура Data Lake (озера данных)` организована таким образом, чтобы эффективно собирать, хранить, обрабатывать и анализировать большие объемы данных из различных источников. \
Она состоит из нескольких ключевых компонентов и слоев, которые обеспечивают интеграцию данных, управление метаданными, безопасность и доступность данных для аналитики.
Основные компоненты и слои архитектуры Data Lake

1. Источники данных (Data Sources)
2. Хранилище данных (Data Storage)
3. Слой обработки данных (Data Processing Layer)
4. Слой управления метаданными (Metadata Management Layer)
5. Слой безопасности и управления (Security and Governance Layer)
6. Слой аналитики и потребления данных (Analytics and Consumption Layer)